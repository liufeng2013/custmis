KISSY.Editor.add("colorsupport/dialog",function(w){var k=KISSY,l=k.Editor;k.log("colorsupport/dialog attach");l.ColorSupport.ColorPicker||function(){function m(a){if(k.isArray(a))return a;var c=RegExp;if(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.test(a))return i([c.$1,c.$2,c.$3],function(d){return parseInt(d,16)});else if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return i([c.$1,c.$2,c.$3],function(d){return parseInt(d+d,16)});else if(/^rgb\((.*),(.*),(.*)\)$/i.test(a))return i([c.$1,c.$2,c.$3],
function(d){return d.indexOf("%")>0?parseFloat(d,10)*2.55:d|0})}function p(a){a="0"+a;var c=a.length;return a.slice(c-2,c)}function q(a){a=m(a);return"#"+p(a[0].toString(16))+p(a[1].toString(16))+p(a[2].toString(16))}function s(){this._init()}var i=l.Utils.map,n=k.DOM;n.addStyleSheet(".ke-color-advanced-picker-left {float:left;display:inline;margin-left:10px;}.ke-color-advanced-picker-right {float:right;width:50px;display:inline;margin:13px 10px 0 0;cursor:crosshair;}.ke-color-advanced-picker-right a {height:2px;line-height:0;font-size:0;display:block;}.ke-color-advanced-picker-left ul{float:left;}.ke-color-advanced-picker-left li,.ke-color-advanced-picker-left a{overflow:hidden;width:15px;height:16px;line-height:0;font-size:0;display:block;}.ke-color-advanced-picker-left a:hover{width:13px;height:13px;border:1px solid white;}.ke-color-advanced-indicator {margin-left:10px;*zoom:1;display:inline-block;*display:inline;width:68px;height:24px;vertical-align:middle;line-height:0;overflow:hidden;}",
"ke-color-advanced");var r=function(){function a(b,e,g){var h=[];b=c(b);e=c(e);var f=(e[0]-b[0])/g,j=(e[1]-b[1])/g,x=(e[2]-b[2])/g,o=0,t=b[0],u=b[1];for(b=b[2];o<g;o++){h[o]=[t,u,b];t+=f;u+=j;b+=x}h[o]=e;return i(h,function(y){return i(y,function(z){return Math.min(Math.max(0,Math.floor(z)),255)})})}function c(b){var e=m(b);if(e===undefined){if(!d){d=document.createElement("textarea");d.style.display="none";n.prepend(d,document.body)}try{d.style.color=b}catch(g){return[0,0,0]}if(document.defaultView)e=
m(document.defaultView.getComputedStyle(d,null).color);else{b=d.createTextRange().queryCommandValue("ForeColor");e=[b&255,(b&65280)>>>8,(b&16711680)>>>16]}}return e}var d;return function(b,e){var g=[],h=b.length;if(e===undefined)e=20;if(h==1)g=a(b[0],b[0],e);else if(h>1){var f=0;for(h=h-1;f<h;f++){var j=a(b[f],b[f+1],e[f]||e);f<h-1&&j.pop();g=g.concat(j)}}return g}}(),A="<div class='ke-color-advanced-picker'><div class='ks-clear'><div class='ke-color-advanced-picker-left'>"+("<ul>"+i(r(["red","orange",
"yellow","green","cyan","blue","purple"],5),function(a){return i(r(["white","rgb("+a.join(",")+")","black"],5),function(c){return"<li><a style='background-color:"+q(c)+"' href='#'></a></li>"}).join("")}).join("</ul><ul>")+"</ul>")+"</div><div class='ke-color-advanced-picker-right'></div></div><div style='padding:10px;'><label>\u989c\u8272\u503c\uff1a <input style='width:100px' class='ke-color-advanced-value'/></label><span class='ke-color-advanced-indicator'></span></div></div>";k.augment(s,{_init:function(){var a=this;
a.win=new l.Dialog({mask:true,headerContent:"\u989c\u8272\u62fe\u53d6\u5668",bodyContent:A,footerContent:"<div style='padding:5px 20px 20px;'><a class='ke-button ke-color-advanced-ok'>\u786e\u5b9a</a>&nbsp;&nbsp;&nbsp;<a class='ke-button  ke-color-advanced-cancel'>\u53d6\u6d88</a></div>",width:"550px"});var c=a.win;c.renderer();var d=c.get("body"),b=c.get("footer"),e=d.one(".ke-color-advanced-indicator"),g=d.one(".ke-color-advanced-value"),h=d.one(".ke-color-advanced-picker-left");d.one(".ke-color-advanced-picker-right");c=b.one(".ke-color-advanced-ok");
b=b.one(".ke-color-advanced-cancel");c.on("click",function(){if(/^#([a-f0-9]{1,2}){3,3}$/i.test(k.trim(g.val()))){a.hide();a.cmd._applyColor(g.val())}else alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u989c\u8272\u4ee3\u7801")});g.on("change",function(){var f=k.trim(g.val());/^#([a-f0-9]{1,2}){3,3}$/i.test(f)?e.css("background-color",f):alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u989c\u8272\u4ee3\u7801")});b.on("click",function(){a.hide()});d.on("click",function(f){f.halt();f=f.target;if(n._4e_name(f)=="a"){var j=q(n.css(f,"background-color"));h.contains(f)&&a._detailColor(j);g.val(j);e.css("background-color",
j)}});a._detailColor("#FF9900");g.val("#FF9900");e.css("background-color","#FF9900")},_detailColor:function(a){this.win.get("body").one(".ke-color-advanced-picker-right").html(i(r(["#ffffff",a,"#000000"],40),function(c){return"<a style='background-color:"+q(c)+"'></a>"}).join(""))},show:function(a){this.cmd=a;this.win.show()},hide:function(){this.win.hide()}});l.ColorSupport.ColorPicker=s}();var v=new l.ColorSupport.ColorPicker;w.addDialog("colorsupport/dialog",{show:function(m){v.show(m)},hide:function(){v.hide()}})});
